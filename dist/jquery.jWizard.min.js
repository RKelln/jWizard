/*! jWizard v1.7.0 Built: 2013-02-24 */
(function(e){e.widget("db.progressbar",e.ui.progressbar,{_create:function(){this._super(),this.options.label&&this._createLabel(),this._refreshValue()},_destroy:function(){this.options.label&&this._destroyLabel(),this._super()},_refreshValue:function(){this._superApply(arguments),this.label&&this._updateLabel()},_setOption:function(e){"value"===e&&this.options.label&&this._updateLabel(),this._superApply(arguments)},_createLabel:function(){this.label=e('<span class="ui-progressbar-label"></span>').appendTo(this.element),this._updateLabel()},_updateLabel:function(){var e=this.options,t="count"===e.label?this._count():this._percentage()+"%";e.append&&(t+=" "+e.append),this.label.text(t).position({my:"center",at:"center",of:this.element})},_destroyLabel:function(){this.label.remove()},_count:function(){return this.value()+" of "+this.options.max},options:{label:null,append:!1}}),e.widget("db.jWizard",{$steps:null,$current:null,widgetEventPrefix:"wizard",_create:function(){var e=this.options;this._super(),this.element.addClass("ui-widget jw-widget"),this._buildSteps(),e.title&&this._buildTitle(),e.menu&&this._buildMenu(),this._buildButtons(),e.progress&&this._buildProgress()},destroy:function(){var e=this.options;this.element.removeClass("ui-widget jw-widget jw-hasprogress"),e.progress&&this._destroyProgress(),this._destroyButtons(),e.menu&&this._destroyMenu(),e.title&&this._destroyTitle(),this._destroySteps(),this._super()},first:function(){return this.step(this.$steps.first())},last:function(){return this.step(this.$steps.last())},cancel:function(){this._trigger("cancel")},prev:function(){return this.step(this.$current.prev())},next:function(){return this.step(this.$current.next())},finish:function(){this._trigger("finish")},step:function(t){function s(){n._enter(n.$current).then(r.resolve,r.reject)}function i(){n._enableButtons(),r.resolve()}var n=this,r=e.Deferred();return"number"==typeof t&&(t=this.$steps.eq(t)),this._disableButtons(),this._leave(this.$current).then(function(){n._enter(t).then(i,s)},s),r.promise()},_leave:function(t){var s=e.Event("stephide"),i=e.Deferred(),n=this.options.effects.steps.hide;return t?(t.trigger(s),s.isDefaultPrevented()?i.reject():this._hide(t,n,function(){t.trigger("stephidden"),i.resolve()})):i.resolve(),i.promise()},_enter:function(t){var s=this,i=e.Event("stepshow"),n=e.Deferred(),r=this.options.effects.steps.show;return t?(t.trigger(i),i.isDefaultPrevented()?n.reject():this._show(t,r,function(){s.$current=t,s._updateTitle(),s._updateMenu(),s._updateButtons(),s._updateProgress(),t.trigger("stepshown"),n.resolve()})):n.resolve(),n.promise()},_buildTitle:function(){this.$title||(this.$title=e('<h2 class="jw-title" />'),this.$header=e('<div class="jw-header ui-widget-header ui-corner-top ui-helper-clearfix">').append(this.$title).prependTo(this.element),this._updateTitle())},_updateTitle:function(){var e=this.$title;e&&e.text(this.$current.data("jwizard-title"))},_destroyTitle:function(){this.$header.remove(),this.$title=this.$header=null},_buildSteps:function(){var t=this.$steps=this.element.children();t.addClass("jw-step").each(function(){var t,s=e(this);t=s.is("fieldset")?s.find("legend").text():s.attr("title"),t&&s.data("jwizard-title",t)}),t.hide().wrapAll(e("<div />",{"class":"jw-content ui-widget-content ui-helper-clearfix",html:'<div class="jw-steps-wrap" />'})),this.$current=this.$steps.first().show()},_destroySteps:function(){this.$steps.show().unwrap().unwrap().removeData("jwizard-title").removeClass("jw-step"),this.$steps=null},_buildMenu:function(){var t=this;this.element.addClass("jw-hasmenu"),this.$menu||(this.$menu=e("<ol>",{"class":"jw-menu",html:e.map(this.$steps,function(t){var s=e(t).data("jwizard-title");return'<li><a href="javascript:void(0);">'+s+"</a>"}).join("")}).menu({select:function(e,s){t.step(s.item.index())}}),this.$menuWrap=e('<div class="jw-menu-wrap">').append(this.$menu).prependTo(this.element.children(".jw-content")),this._updateMenu())},_updateMenu:function(){if(this.$menu){var e=this.$current.index();this.$menu.children("li").removeClass("ui-state-highlight ui-state-disabled").eq(e).addClass("ui-state-highlight").end().slice(e).addClass("ui-state-disabled")}},_destroyMenu:function(){this.element.removeClass("jw-hasmenu"),this.$menu.menu("destroy"),this.$menuWrap.remove(),this.$menu=this.$menuWrap=null},_buildProgress:function(){if(!this.$progress){var t=e.extend({},this.options.progress),s=t.location,i=e("<div>").appendTo(this.element.find(s));delete t.location,t.max=this.$steps.length,this.element.addClass("jw-hasprogress"),this.$progress=i.progressbar(t).addClass("jw-progress"),this._updateProgress()}},_updateProgress:function(){if(this.$progress){var e=this.$current,t=e?e.index():0;this.$progress.progressbar("value",t)}},_destroyProgress:function(){this.element.removeClass("jw-hasprogress"),this.$progress.progressbar("destroy").remove(),this.$progress=null},_buildButtons:function(){var t=this,s=e("<div>",{"class":"jw-footer ui-widget-header ui-corner-bottom",html:'<div class="jw-buttons"></div>'});e.each(this.options.buttons,function(i,n){var r=e.extend({},n),o=r.icons;delete r.icons,r["class"]=r["class"]||"",r["class"]+=" jw-button-"+i,n&&(t["$"+i]=e("<button>",r).button({icons:o}).appendTo(s.children(".jw-buttons")))}),this.element.append(s),this._on({"click .jw-button-cancel":function(){t.cancel()},"click .jw-button-prev":function(){t.prev()},"click .jw-button-next":function(){t.next()},"click .jw-button-finish":function(){t.finish()}}),this._updateButtons()},_updateButtons:function(){var e=this.$steps,t=this.$current,s=this.$prev,i=this.$next,n=this.$finish;switch(t.index()){case 0:s.hide(),i.show(),n.hide();break;case e.length-1:s.show(),i.hide(),n.show();break;default:s.show(),i.show(),n.hide()}},_destroyButtons:function(){this.element.find(".jw-footer").remove()},_disableButtons:function(){this.element.find(".jw-footer").find("button").addClass("ui-state-disabled")},_enableButtons:function(){this.element.find(".jw-footer").find("button").removeClass("ui-state-disabled")},_setOption:function(e,t){switch(this._superApply(arguments),e){case"title":this[t?"_buildTitle":"_destroyTitle"]();break;case"menu":this[t?"_buildMenu":"_destroyMenu"]();break;case"buttons":this._destroyButtons(),this._buildButtons();break;case"progress":this._destroyProgress(),this._buildProgress()}},options:{title:!0,menu:!0,buttons:{cancel:{"class":"ui-priority-secondary",text:"Cancel",type:"reset",icons:{primary:"ui-icon-circle-close"}},prev:{text:"Previous",type:"button",icons:{primary:"ui-icon-circle-triangle-w"}},next:{text:"Next",type:"button",icons:{secondary:"ui-icon-circle-triangle-e"}},finish:{"class":"ui-priority-primary ui-state-highlight",text:"Finish",type:"submit",icons:{secondary:"ui-icon-circle-check"}}},progress:{label:"count",append:"Complete",location:".jw-header"},effects:{steps:{hide:{effect:"blind",direction:"left",duration:250},show:{effect:"blind",direction:"left",duration:250}}}}})})(jQuery);